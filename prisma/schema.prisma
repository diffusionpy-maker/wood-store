
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password_hash String
  name          String?
  oauth_google_id String?
  oauth_line_id String? @unique
  is_guest      Boolean?
  status        String?
  created_at    DateTime?
  updated_at    DateTime?
  addresses     UserAddress[]
  favorites     Favorite[]
  carts         Cart[]
  orders        Order[]
}

model UserAddress {
  id              Int      @id @default(autoincrement())
  user_id         Int
  recipient_name  String?
  recipient_phone String?
  address_line    String?
  is_default      Boolean?
  created_at      DateTime?
  updated_at      DateTime?
  user            User     @relation(fields: [user_id], references: [id])
}

model Category {
  id         Int      @id @default(autoincrement())
  name       String
  slug       String   @unique
  parent_id  Int?
  is_active  Boolean?
  sort_order Int?
  created_at DateTime?
  updated_at DateTime?
  parent     Category? @relation("CategoryParent", fields: [parent_id], references: [id])
  children   Category[] @relation("CategoryParent")
  products   Product[]
}

model Product {
  id             Int      @id @default(autoincrement())
  name           String
  slug           String   @unique
  category_id    Int?
  description    String?
  material       String?
  price          Int
  stock_quantity Int?
  is_active      Boolean?
  is_featured    Boolean?
  created_at     DateTime?
  updated_at     DateTime?
  category    Category? @relation(fields: [category_id], references: [id])
  images         ProductImage[]
  favorites      Favorite[]
  cart_items     CartItem[]
  order_items    OrderItem[]
}

model ProductImage {
  id         Int      @id @default(autoincrement())
  product_id Int
  image_url  String
  alt_text   String?
  sort_order Int?
  created_at DateTime?
  product    Product  @relation(fields: [product_id], references: [id])
}

model Favorite {
  id         Int      @id @default(autoincrement())
  user_id    Int
  product_id Int
  created_at DateTime?
  user       User     @relation(fields: [user_id], references: [id])
  product    Product  @relation(fields: [product_id], references: [id])
}

model Cart {
  id         Int      @id @default(autoincrement())
  user_id    Int
  session_id String?
  created_at DateTime?
  updated_at DateTime?
  user       User     @relation(fields: [user_id], references: [id])
  items      CartItem[]
}

model CartItem {
  id         Int      @id @default(autoincrement())
  cart_id    Int
  product_id Int
  quantity   Int
  unit_price Int
  created_at DateTime?
  updated_at DateTime?
  cart       Cart     @relation(fields: [cart_id], references: [id])
  product    Product  @relation(fields: [product_id], references: [id])
}

model Order {
  id               Int      @id @default(autoincrement())
  order_number     String   @unique
  user_id          Int
  status           String?
  payment_status   String?
  payment_method   String?
  total_amount     Int?
  shipping_fee     Int?
  recipient_name   String?
  recipient_phone  String?
  shipping_address String?
  shipping_type    String?
  notes            String?
  placed_at        DateTime?
  paid_at          DateTime?
  shipped_at       DateTime?
  completed_at     DateTime?
  cancelled_at     DateTime?
  created_at       DateTime?
  updated_at       DateTime?
  user             User     @relation(fields: [user_id], references: [id])
  items            OrderItem[]
  payments         Payment[]
}

model OrderItem {
  id              Int      @id @default(autoincrement())
  order_id        Int
  product_id      Int
  product_name    String?
  unit_price      Int
  quantity        Int
  subtotal_amount Int?
  created_at      DateTime?
  order           Order    @relation(fields: [order_id], references: [id])
  product         Product  @relation(fields: [product_id], references: [id])
}

model Payment {
  id             Int      @id @default(autoincrement())
  order_id       Int
  gateway        String?
  transaction_id String?
  amount         Int?
  currency       String?
  status         String?
  paid_at        DateTime?
  raw_response   String?
  created_at     DateTime?
  updated_at     DateTime?
  order          Order    @relation(fields: [order_id], references: [id])
}

model AdminUser {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  password_hash String?
  name       String?
  role       String?
  status     String?
  created_at DateTime?
  updated_at DateTime?
}
